services:
  traefik:
    image: traefik:v3.2
    container_name: traefik
    restart: always
    command:
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--providers.file.filename=/etc/traefik/dynamic_conf.yml"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "./config/traefik/dynamic_conf.yml:/etc/traefik/dynamic_conf.yml"
      - "./config/traefik/certs:/certs"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    networks:
      - traefik-network
  bind9:
    image: internetsystemsconsortium/bind9:9.18
    container_name: bind9
    restart: always
    ports:
      - "10.0.0.11:53:53/tcp"
      - "10.0.0.11:53:53/udp"
    volumes:
      - "./config/bind9/named.conf:/etc/bind/named.conf"
      - "./config/bind9/named.conf.local:/etc/bind/named.conf.local"
      - "./config/bind9/named.conf.options:/etc/bind/named.conf.options"
      - "./config/bind9/db.powerzio.net:/etc/bind/db.powerzio.net"
  bank-app:
    container_name: bank-app
    build:
      context: .
      dockerfile: config/bank-app/Dockerfile
    restart: always
    volumes:
      - ./apps/bank-app:/var/www/app
    networks:
      - traefik-network
  wall-app:
    container_name: wall-app
    build:
      context: .
      dockerfile: config/wall-app/Dockerfile
    restart: always
    networks:
      - traefik-network
  cdn-app:
    container_name: cdn
    image: nginx:stable
    restart: always
    volumes:
      - "./apps/cdn-app:/usr/share/nginx/html"
      - "./config/cdn-app/nginx.conf:/etc/nginx/nginx.conf"
    networks:
      - traefik-network
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus:/etc/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    restart: always
    networks:
      - health
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=unsecured
    volumes:
      - grafana_data:/var/lib/grafana
    depends_on:
      - prometheus
    restart: always
    networks:
      - health

networks:
  traefik-network:
    driver: bridge
  health:
    driver: bridge